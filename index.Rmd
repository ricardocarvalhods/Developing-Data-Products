---
title       : Death Risk Analysis
subtitle    : Developing Data Products - Course Project
author      : Ricardo S. Carvalho
job         : Coursera Data Science Specialization
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
logo        : coursera.svg
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
github:
  user: ricardoscr
  repo: Developing-Data-Products
---

```{r, echo=FALSE, results='hide', warning=FALSE}
library(ggplot2)
deathdata <- data.frame(age=c('00-01','01-04','05-14','15-24','25-34','35-44','45-54','55-64','65-74','75-84','85-99','00-01','01-04','05-14','15-24','25-34','35-44','45-54','55-64','65-74','75-84','85-99'),
                        Age=c(0,2.5,10,20,30,46,50,60,70,80,90,0,2.5,10,20,30,46,50,60,70,80,90),
                        rate=c(177,4386,8333,1908,1215,663,279,112,42,15,6,227,5376,10417,4132,2488,1106,421,178,65,21,7),
                        gender=c('Male','Male','Male','Male','Male','Male','Male','Male','Male','Male','Male','Female','Female','Female','Female','Female','Female','Female','Female','Female','Female','Female'))
deathdata$age <- as.character(deathdata$age)
input.data <- subset(deathdata, age == '45-54' & gender == 'Male')
```

## Overview of the app

* We give death rates little attention on our daily lives, except when they are forced on us by some catastrophe, societal or personal.
* It is useful to be reminded of the major effects on death rates - namely our sex, and our age.
* The shiny app built does the following analysis for specific user given age and gender:
 * Age effects
 * Gender effects
 * Prediction from Linear Model
* Link for the app: https://ricardosc.shinyapps.io/DevDataProd/
* Data were taken from UK national mortality statistics
 * http://www.medicine.ox.ac.uk/bandolier/booth/Risk/dyingage.html

--- .class #id

## Age

* Historical data shows that, generally, for any gender, the older you get, the greater is your risk of dying in any one year, so we have to be careful.
* Our app, for a gender given by the user (labeled as __You__), shows how the age affects death risk, as on the following plot:
```{r, echo=FALSE, fig.height=5, fig.width=10, fig.align='center'}
g <- ggplot(deathdata[deathdata$gender == input.data$gender,], aes(x=age, y=log(1/rate))) + geom_point(size=4) +
    geom_point(data=input.data, colour="blue", size=4) +
    geom_text(data=input.data, label="You", hjust=1.3, size=7, colour="blue") +
    labs(title=paste0("Log of the inverse of the number of ", input.data$gender, " deaths by Age"))
plot(g)
```

--- .class #id 

## Gender

* Additionally, our app gives a gender analysis for death risk specific for the user (labeled as __You__), as in the following plot:
```{r, echo=FALSE, fig.height=5, fig.width=10, fig.align='center'}
g <- ggplot(deathdata, aes(x=age, y=log(1/rate), color=gender)) + geom_point(size=4) +
    geom_point(data=input.data, colour="blue", size=4) +
    geom_text(data=input.data, label="You", hjust=1.3, size=7, colour="blue") +
    labs(title=paste0("Log of the inverse of the number of deaths by Age and gender"))
plot(g)

test <- t.test(rate ~ gender, data=deathdata, paired=FALSE, var.equal=TRUE)
ptest <- round(test$p.value, 3)
```
* Although, that gender analysis is too simplistic. Therefore, our app takes a Two Sample T-Test, which gives a p-value of 0.605, stating that we cannot affirm, with the data available, that there is a significant difference in risk for gender.

--- .class #id 

## Linear Model

* Using a linear regression for death risk, our app shows the predictive model, along with the user data (labeled as __You__) and the original data.
* The linear model is as close as possible to the points, but it may produce different risks than the original data points. Our app shows how the predicted risk compares to the original risk for the user, as in the image:
```{r, echo=FALSE, fig.height=5, fig.width=10, fig.align='center'}
get.pred.out <- function(deathdata, input.data){
  pred <- deathdata[deathdata$gender==input.data$gender,]
  pred$rateorig <- pred$rate
  pred$rateinv <- log(1/pred$rateorig)
  pred$age_prox2 <- pred$Age
  
  pred.out <- pred[pred$gender==input.data$gender & pred$age == input.data$age,]
  
  pred.out$rate <- as.data.frame(1/exp(predict(lm(rateinv ~ age_prox2, data=pred), pred.out)))
  
  return(pred.out)
}
pred.out <- get.pred.out(deathdata, input.data)
g <- ggplot(deathdata[deathdata$gender==input.data$gender,], aes(x=Age, y=log(1/rate), color=gender)) + 
  geom_point(size=4) +
  geom_smooth(method="lm", col="green", size=1) +
  geom_point(data=pred.out, colour="blue", size=4) +
  geom_text(data=pred.out, label="You", vjust=-1.2, size=7, colour="blue") +
  labs(title=paste0("Log of the inverse of the number of ", input.data$gender, " deaths by Age"))

plot(g)
```
